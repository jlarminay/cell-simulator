function makeMap(size){for($(".map-table tr").remove(),size.indexOf("x")>=0?(t=size.split("x"),width=t[0],height=t[1]):(width=size,height=size),json.size=size,j=0;j<height;){for(i=0,row="<tr>";i<width;)row+="<td>.</td>",i++;row+="</tr>",$(".map-table tbody").append(row),j++}}function makeClans(){$.each(json.clans,function(index,val){string="",string+="<tr class='clan-controls'>",string+="<td><div class='btn btn-danger rem-clan' title='Remove Team'><i class='fas fa-minus'></i></div></td>",string+="<td data-title='name' contenteditable>"+val.name+"</td>",string+="<td data-title='color' contenteditable>"+val.color+"</td>",string+="<td data-title='health' contenteditable>"+val.health+"</td>",string+="<td data-title='attack' contenteditable>"+val.attack+"</td>",string+="<td data-title='defence' contenteditable>"+val.defence+"</td>",string+="<td data-title='evasion' contenteditable>"+val.evasion+"</td>",string+="<td data-title='lifeloss' contenteditable>"+val.lifeloss+"</td>",string+="<td class='h' data-title='speed' contenteditable>"+val.speed+"</td>",string+="</tr>",$(".clans-table tr:last").after(string)})}function addClan(){string="",string+="<tr class='clan-controls'>",string+="<td><div class='btn btn-danger rem-clan' title='Remove Team'><i class='fas fa-minus'></i></div></td>",string+="<td data-title='name' contenteditable>-</td>",string+="<td data-title='color' contenteditable>-</td>",string+="<td data-title='health' contenteditable>1</td>",string+="<td data-title='attack' contenteditable>1</td>",string+="<td data-title='defence' contenteditable>1</td>",string+="<td data-title='evasion' contenteditable>1</td>",string+="<td data-title='lifeloss' contenteditable>0</td>",string+="<td class='h' data-title='speed' contenteditable>1</td>",string+="</tr>",$(".clans-table tr:last").after(string)}function updateMapControls(){$("#tab-map .paint").remove(),$.each(items,function(index,val){$("#tab-map .controls").append('<div class="paint" data-char="'+val.char+'" data-col="'+val.col+'" title="Tile: '+val.title+'" style="background-color:'+val.col+'">'+val.char+"</div>")}),$("#tab-map .controls").append("<div></div>"),$.each(json.clans,function(index,val){$("#tab-map .controls").append('<div class="paint" data-char="'+index+'" data-col="'+val.color+'" title="Team: '+val.name+'" style="background-color:'+val.color+'">'+index+"</div>")})}function updateClans(){tmp_clans=[],$(".clan-controls").each(function(i,val){tmp_clans[i]={name:$(this).find("[data-title=name]").text(),color:$(this).find("[data-title=color]").text(),health:$(this).find("[data-title=health]").text(),attack:$(this).find("[data-title=attack]").text(),defence:$(this).find("[data-title=defence]").text(),evasion:$(this).find("[data-title=evasion]").text(),lifeloss:$(this).find("[data-title=lifeloss]").text(),speed:$(this).find("[data-title=speed]").text(),time:null},i++}),json.clans=tmp_clans,updateMapWithColors()}function updateSettings(){isNaN(parseInt($(".game-table #speed").val()))?json.speed=0:json.speed=parseInt($(".game-table #speed").val()),$(".game-table #limit").hide(),json.victoryType=$(".game-table #victory").val(),"time"==json.victoryType?($(".game-table #limit").show(),json.limit_time=parseInt($(".game-table #limit").val())):"turn"==json.victoryType&&($(".game-table #limit").show(),json.limit_turn=parseInt($(".game-table #limit").val())),json.randomSpawn="true"==$(".game-table #spawn").val()}function updateMapWithColors(){$(".map-table td").each(function(){val=$(this).text(),(Number(val)||"0"==val)&&$(this).css("background",json.clans[val].color)})}items=[{char:".",col:"white",title:"Empty Space"},{char:"w",col:"black",title:"Wall"},{char:"^",col:"lightgrey",title:"One Way Wall - Up"},{char:">",col:"lightgrey",title:"One Way Wall - Right"},{char:"v",col:"lightgrey",title:"One Way Wall - Down"},{char:"<",col:"lightgrey",title:"One Way Wall - Right"}],default_clan={health:1,attack:1,defence:0,evasion:1,lifeloss:0,speed:1},json={clans:[{name:"Red Bois",color:"red",health:default_clan.health,attack:default_clan.attack,defence:default_clan.defence,evasion:default_clan.evasion,lifeloss:default_clan.lifeloss,speed:default_clan.speed,time:null},{name:"Hydro Homies",color:"blue",health:default_clan.health,attack:default_clan.attack,defence:default_clan.defence,evasion:default_clan.evasion,lifeloss:default_clan.lifeloss,speed:default_clan.speed,time:null},{name:"Plant Army",color:"green",health:default_clan.health,attack:default_clan.attack,defence:default_clan.defence,evasion:default_clan.evasion,lifeloss:default_clan.lifeloss,speed:default_clan.speed,time:null},{name:"The Dutch",color:"orange",health:default_clan.health,attack:default_clan.attack,defence:default_clan.defence,evasion:default_clan.evasion,lifeloss:default_clan.lifeloss,speed:default_clan.speed,time:null}],speed:0,limit_time:0,limit_turn:0,randomSpawn:!1,cellSquare:!1,victoryType:"control"},$(function(){makeMap("40x20"),makeClans(),updateMapControls(),updateSettings(),$(".make-map").click(function(){size=prompt("How big is the map?","40x20"),null!=size&&makeMap(size)}),$(".add-clan").click(function(){addClan()}),$(document).on("click",".rem-clan",function(){$(this).parents(".clan-controls").remove()}),$(document).on("keyup",".clans-table [contenteditable]",function(){updateClans(),updateMapControls()}),$(".game-table .form-control").change(function(){updateSettings()}),isDown=!1,$(document).mousedown(function(){isDown=!0}).mouseup(function(){isDown=!1}),$(document).on("mouseover",".map-table td",function(){isDown&&($(this).text($(".paint.active").attr("data-char")),$(this).css("background",$(".paint.active").attr("data-col")))}),$(document).on("mousedown",".map-table td",function(){$(this).text($(".paint.active").attr("data-char")),$(this).css("background",$(".paint.active").attr("data-col"))}),$(document).on("click",".paint",function(){$(".paint").removeClass("active"),$(this).addClass("active")}),$(".save").click(function(){var final_grid=[],final_grid_row=[],count=0,i=0;$(".map-table td").each(function(index,ele){val=$(ele).text(),final_grid_row[count]=val,++count>=width&&(final_grid.push(final_grid_row),count=0,final_grid_row=[])}),json.map=final_grid,url="index.html?map="+encodeURI(JSON.stringify(json)),console.log(JSON.stringify(json)),console.log(url.length),"url"==$(this).attr("data")?alert(url):window.open(url,"_blank")})});